"use strict";window.dataLayer=window.dataLayer||[],document.shopAnalytics={getProductsData:function(e){var o={};return e.each(function(){var e=jQuery(this).data(),t={name:e.name,id:String(e.ecommerce_track_id),price:e.price,category:e.category};e.brand&&(t.brand=e.brand),e.variant&&(t.variant=e.variant),e.quantity&&(t.quantity=parseInt(e.quantity)),e.position&&(t.position=e.position),e.list&&(t.list=e.list),o[e.list+":"+e.position+":"+t.id]=t}),Object.values(o)},getProductsListType:function(e){return e.closest(".cross-sells").length?"Cross-sells products":e.closest(".related").length?"Related products":"Product Category"},getProductVariationAttributes:function(e){var t=[];return jQuery(e).each(function(){var e=jQuery(this);e.val().trim()&&t.push(e.text().trim())}),t.join(", ")},getVariationId:function(){return jQuery(".woocommerce-variation-add-to-cart-enabled .variation_id").val()},getVariationName:function(e){return jQuery("#data-shop-analytics-"+e).data("custom-product-name")},updateCartItemsQuantity:function(e){e.each(function(){var e=jQuery(this),t=e.data("item_key");e.data("quantity",jQuery('[name="cart['+t+'][qty]"]').val())})},postToDataLayer:function(e){"object"==typeof e&&("on"===shop_analytics_settings.datalayer_console_log&&console.dir(e),1==shop_analytics_settings.tc_enabled?(window.tc_vars=window.tc_vars||[],window.event_data=window.event_data||[],window.event_data.push(e),window.tC.event.generic_event(this,{payload:window.event_data})):window.dataLayer.push(e))},event:{click:{login:'.woocommerce-form-login button[name="login"]',register:'.woocommerce-form-register button[name="register"]',registerOnCheckout:".woocommerce-checkout #place_order"}},cart:{elements:{product:".shop-analytics-product-info",shippingMethods:'select.shipping_method, input[name^="shipping_method"]',shippingMethodSelected:'select.shipping_method:selected, input[name^="shipping_method"]:checked',paymentMethods:'select.payment_method, input[name^="payment_method"]',paymentMethodSelected:'select.payment_method:selected, input[name^="payment_method"]:checked'}},checkout:{dataInit:{event:"EECcheckout",ecommerce:{checkout:{actionField:{step:0},products:[]}}},elements:{shippingMethods:'select.shipping_method, input[name^="shipping_method"]',shippingMethodSelected:'select.shipping_method:selected, input[name^="shipping_method"]:checked',paymentMethods:'input[name="payment_method"]',paymentMethodSelected:'select.payment_method:selected, input[name="payment_method"]:checked',billingAddressFields:".woocommerce-billing-fields input.input-text, .woocommerce-billing-fields select",billingAddressFieldsRequired:".woocommerce-billing-fields .validate-required input.input-text, .woocommerce-billing-fields .validate-required select",shippingAddressFields:".woocommerce-shipping-fields input.input-text, .woocommerce-shipping-fields select",shippingAddressFieldsRequired:".woocommerce-shipping-fields .validate-required input.input-text, .woocommerce-shipping-fields .validate-required select",shippingAddressToggle:"#ship-to-different-address-checkbox",checkoutPlaceOrderButton:"#place_order"},messages:{shipToSameAddress:"Ship to same address",shipToDifferentAddress:"Ship to different address"}},product:{elements:{addToCartButton:".single_add_to_cart_button",singleProductDetails:".shop-analytics-single-product-details"}}},function(i){var c=document.shopAnalytics,t=0,o=0;function r(){var n,a,e=i(document).find(".shop-analytics-product-details");e.length&&!e.parents(".shop-analytics-order-details").length&&(t=t||e.length,n=1,a="",e.each(function(e){var t=i(this),o=c.getProductsListType(t);a!==o&&(a=o,n=1),t.data("position",n++),t.data("list",o)}),e.length>t&&(e=e.filter("body.woocommerce ul.products .shop-analytics-product-details").slice(t),t=e.length),e={event:"EECproductImpression",ecommerce:{currencyCode:e.first().data("currency"),impressions:c.getProductsData(e)}},c.postToDataLayer(e),o||window.setTimeout(function(){o=function(){var e=document.querySelector("body.woocommerce ul.products");if(e)return document.productsLoaded=document.querySelector("body.woocommerce ul.products").childNodes.length,new MutationObserver(function(e){e.forEach(function(e){var t=document.querySelector("body.woocommerce ul.products").childNodes.length;null!==e.addedNodes&&t!==document.productsLoaded&&(document.productsLoaded=t,r())})}).observe(e,{childList:!0})}()},500))}function e(e,t){(t=void 0===t?i(e.target):t).hasClass("disabled")||(t={event:"EECaddToCart",ecommerce:{currencyCode:(e=t.hasClass("single_add_to_cart_button")?i(".shop-analytics-single-product-details"):t.closest(".product").find(".shop-analytics-product-details")).first().data("currency"),add:{products:c.getProductsData(e)}}},(e=c.getProductVariationAttributes(".variations_form option:selected"))&&(t.ecommerce.add.products[0].variant=e,e=c.getVariationId(),t.ecommerce.add.products[0].id=e,(e=c.getVariationName(e))&&(t.ecommerce.add.products[0].name=e)),c.postToDataLayer(t))}function n(){c.postToDataLayer({event:"UniversalEvent",eventCategory:"User",eventAction:"Click",eventLabel:"register"})}function a(e){var t;e.length&&(e={event:"EECremoveFromCart",ecommerce:{remove:{products:t=c.getProductsData(e)}}},localStorage.setItem("productsInCartData",JSON.stringify(t)),c.postToDataLayer(e))}i(document).ready(r).on("click",c.event.click.login,function(){c.postToDataLayer({event:"UniversalEvent",eventCategory:"User",eventAction:"Click",eventLabel:"login"})}).on("click",c.event.click.register,n).on("click",c.event.click.registerOnCheckout,function(){i("#createaccount").is(":checked")&&n()}).on("click",".products .product a",function(){var e=i(this).closest(".product").find(".shop-analytics-product-details"),t=e.first().data("list"),e={event:"EECproductClick",ecommerce:{click:{actionField:{list:t},products:c.getProductsData(e)}}};localStorage.setItem("shop-analytics-list-type",t),c.postToDataLayer(e)}).on("click",".single_add_to_cart_button",e).on("click",".remove_from_cart_button, .woocommerce-cart-form .product-remove > a, .cart_item td.product-remove .remove",function(){var e=i(this).prev(c.cart.elements.product);c.updateCartItemsQuantity(e),a(e)}).on("click","th.product-remove .remove",function(){var e=i(c.cart.elements.product);c.updateCartItemsQuantity(e),a(e)}).on("click","nav a",function(e){var t=null,o="";o=(t=this.closest("nav[aria-label]"))?t.getAttribute("aria-label"):(t=this.closest("nav[id]"))?t.getAttribute("id"):"unknown";o={event:"UniversalEvent",eventCategory:"User Interaction | "+o+" menu",eventAction:"Click",eventLabel:this.innerText};c.postToDataLayer(o)}),i(document.body).on("adding_to_cart",e),i(document).ajaxSuccess(function(e,t,o){var n;void 0!==o&&void 0!==o.data&&0<=o.data.indexOf("nm_cart_panel_remove_product")&&(n=o.data.indexOf("cart_item_key=")+14,n=o.data.substring(n),a(i('a[data-item_key="'+n+'"]')))})}(jQuery);
