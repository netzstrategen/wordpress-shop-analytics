"use strict";!function(o){var r=document.shopAnalytics,t=o(r.cart.elements.product),c=!0;function e(){var e=o(r.cart.elements.shippingMethodSelected);if(e){var t="",c="";if(e.is("select"))c=e.find("option:selected").text();else{if("radio"!==e.attr("type"))return;if(!(t=e.attr("id")))return;c=o('label[for="'+t+'"]').text()}a(shop_analytics_checkout_steps.order,c)}}function s(e){var t=!0;return e.each(function(){o(this).val().trim().length||(t=!1)}),t}function a(e,t){var c=JSON.parse(localStorage.getItem("productsInCartData"));if(c){var o=r.checkout.dataInit;o.ecommerce.checkout.actionField.step=e,t&&(o.ecommerce.checkout.actionField.option=t.trim()),o.ecommerce.checkout.products=c,r.postToDataLayer(o)}}o(function(){if(!t.length)return;var e=r.checkout.dataInit;e.ecommerce.checkout.actionField.step=1,e.ecommerce.checkout.products=r.getProductsData(t),localStorage.setItem("productsInCartData",JSON.stringify(r.getProductsData(t))),r.postToDataLayer(e)}),o(document.body).on("updated_cart_totals",function(){r.updateCartItemsQuantity(t),localStorage.setItem("productsInCartData",JSON.stringify(r.getProductsData(t)))}).on("updated_shipping_method",e).on("payment_method_selected",function(){if(c)return void(c=!1);var e=o(r.checkout.elements.paymentMethodSelected).attr("id");if(!e)return;a(shop_analytics_checkout_steps.order,o('label[for="'+e+'"]').text())}).on("change",r.checkout.elements.billingAddressFields,function(){if(!JSON.parse(localStorage.getItem("productsInCartData")))return;s(o(r.checkout.elements.billingAddressFieldsRequired))&&a(shop_analytics_checkout_steps.order)}).on("change",r.checkout.elements.shippingAddressFields,function(){if(!JSON.parse(localStorage.getItem("productsInCartData")))return;if(s(o(r.checkout.elements.shippingAddressFieldsRequired))){var e=o(r.checkout.elements.shippingAddressToggle).is(":checked")?r.checkout.messages.shipToDifferentAddress:r.checkout.messages.shipToSameAddress;a(shop_analytics_checkout_steps.order,e)}}),o("form.checkout").on("change",r.checkout.elements.shippingMethods,e).on("click",r.checkout.elements.checkoutPlaceOrderButton,function(){localStorage.setItem("shop-analytics-tracked-orders",JSON.stringify([]))})}(jQuery);
