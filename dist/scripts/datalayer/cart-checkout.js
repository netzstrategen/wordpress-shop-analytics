"use strict";!function(o){var s=document.shopAnalytics,t=o(s.cart.elements.product),c=!0;function e(){var e=o(s.cart.elements.shippingMethodSelected);if(e){var t,c="";if(e.is("select"))c=e.find("option:selected").text();else{if("radio"!==e.attr("type"))return;if(!(t=e.attr("id")))return;c=o('label[for="'+t+'"]').text()}a(shop_analytics_checkout_steps.order,c)}}function r(e){var t=!0;return 0===e.length||e.each(function(){(o(this).val()||"").trim().length||(t=!1)}),t}function a(e,t){var c,o=JSON.parse(localStorage.getItem("productsInCartData"));o&&((c=s.checkout.dataInit).ecommerce.checkout.actionField.step=e,t&&(c.ecommerce.checkout.actionField.option=t.trim()),c.ecommerce.checkout.products=o,s.postToDataLayer(c))}o(function(){if(!t.length)return;var e=s.checkout.dataInit;e.ecommerce.checkout.actionField.step=1,e.ecommerce.checkout.products=s.getProductsData(t),localStorage.setItem("productsInCartData",JSON.stringify(s.getProductsData(t))),s.postToDataLayer(e)}),o(document.body).on("updated_cart_totals",function(){s.updateCartItemsQuantity(t),localStorage.setItem("productsInCartData",JSON.stringify(s.getProductsData(t)))}).on("updated_shipping_method",e).on("payment_method_selected",function(){if(c)return void(c=!1);var e=o(s.checkout.elements.paymentMethodSelected).attr("id");if(!e)return;a(shop_analytics_checkout_steps.order,o('label[for="'+e+'"]').text())}).on("change",s.checkout.elements.billingAddressFields,function(){if(!JSON.parse(localStorage.getItem("productsInCartData")))return;r(o(s.checkout.elements.billingAddressFieldsRequired))&&a(shop_analytics_checkout_steps.order)}).on("change",s.checkout.elements.shippingAddressFields,function(){if(!JSON.parse(localStorage.getItem("productsInCartData")))return;{var e;r(o(s.checkout.elements.shippingAddressFieldsRequired))&&(e=o(s.checkout.elements.shippingAddressToggle).is(":checked")?s.checkout.messages.shipToDifferentAddress:s.checkout.messages.shipToSameAddress,a(shop_analytics_checkout_steps.order,e))}}),o("form.checkout").on("change",s.checkout.elements.shippingMethods,e).on("click",s.checkout.elements.checkoutPlaceOrderButton,function(){localStorage.setItem("shop-analytics-tracked-orders",JSON.stringify([]))})}(jQuery);
